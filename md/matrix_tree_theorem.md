# 行列木定理 (Matrix Tree Theorem)

$A_{ij}$を無向グラフの隣接行列とする。 $A$のラプラシアン(Laplacian) $L$とは、以下の行列。

$$
\begin{align*}
L_{ii} = & \sum_j A_{ij} &\\
L_{ij} = & -A_{ij}       & (i\neq j)
\end{align*}
$$

## 行列木定理
グラフの全域木の数は、 $L_0$ を $L$ の 0 行目 0 列目を除いた行列としたとき、$\mathrm{det}(L_0)$ に等しい。

### 証明
http://www-math.mit.edu/~rstan/algcomb/algcomb.pdf の p177 を参考にした。

$L=MM^t$，$L_0=M_0M_0^t$ とかける。ただし、$M$ はグラフを適当に向きづけた接続行列 (始点に $+1$、終点に $-1$) で、$M_0$ はその 0 行目を抜いたもの。
[コーシー・ビネの公式](#md/cauchy_binet.md) より、

$$
\mathrm{det}(L_0)=\sum_{|S|=n-1}(\mathrm{det}(M_0[S]))^2
$$

が成立する。ただし、$S$ は $M_0$ の列インデックスの部分集合。 (ここで $S$ の大きさ制約が $n-1$ になってくれるのが 0 行目を抜いた効果。)
枝集合$S$が、（無向化して）全域木になっている場合のみ
$\mathrm{det}M_0[S]= \pm 1$ となるため、右辺の総和は全域木の総数となる。(ループがあったら適当にたし引きして 0 ベクトルを作れるので、フルランクではない。逆に 0 にできるならループがある。)

## 行列木定理（有向バージョン）
$A$ を有向グラフの隣接行列とし、$L$ をそのラプラシアンとする。

グラフの $r$ を根とする有向全域木 (すべての出次数が1) の数は、 $L_r$を$L$の $r$ 行目 $r$ 列目を除いた行列としたとき、$\mathrm{det}(L_r)$に等しい。
### 証明
TODO: http://math.mit.edu/~levine/18.312/alg-comb-lecture-19.pdf をみて証明を書く。


# 問題集
## TCO14 R3B 1000 Tree Distance
http://www.topcoder.com/tc?module=ProblemDetail&rd=16058&pm=13369

頂点が区別される木に対して、枝を１つ取り除き、再び１つ加えて木にするという操作を高々 $K$ 回行う。できる木は何通りか。$K,N \leq 50$.

### 解法
枝があるところは重み $x$、他の点間は重み 1 であるようなグラフを考える。
行列木定理をこのグラフに適用した結果の値は
$$
\sum_k (\mbox{もとの枝を }k\mbox{ 個使う全域木の数})x^k
$$

となる。
具体的な $x$ に対してこの値を計算することはできるので、$N$ 箇所の点についてこれを計算し、補間を行うことによって、係数の値を求めることができる。

